import{useEffect as e,useLayoutEffect as n,createContext as t,useContext as r,useState as i,createElement as o,useRef as u,useCallback as a,useDebugValue as c}from"react";function f(e,n,t,r){return new(t||(t=Promise))(function(i,o){function u(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(u,a)}c((r=r.apply(e,n||[])).next())})}function s(e,n){var t,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=n.call(e,u)}catch(e){o=[6,e],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var l,d=function(){},v=d(),h=Object,g=function(e){return e===v},p=function(e){return"function"==typeof e},y=function(e,n){return h.assign({},e,n)},b="undefined"!=typeof window,w="undefined"!=typeof document,m=new WeakMap,O=0,E=function(e){var n,t,r=typeof e,i=e&&e.constructor,o=i==Date;if(h(e)!==e||o||i==RegExp)n=o?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(n=m.get(e))return n;if(n=++O+"~",m.set(e,n),i==Array){for(n="@",t=0;t<e.length;t++)n+=E(e[t])+",";m.set(e,n)}if(i==h){n="#";for(var u=h.keys(e).sort();!g(t=u.pop());)g(e[t])||(n+=t+":"+E(e[t])+",");m.set(e,n)}}return n},k=!0,T=b&&window.addEventListener?window.addEventListener.bind(window):d,R=w?document.addEventListener.bind(document):d,S=b&&window.removeEventListener?window.removeEventListener:d,V=w?document.removeEventListener.bind(document):d,I={isOnline:function(){return k},isVisible:function(){var e=w&&document.visibilityState;return!!g(e)||"hidden"!==e}},x={initFocus:function(e){return R("visibilitychange",e),T("focus",e),function(){V("visibilitychange",e),S("focus",e)}},initReconnect:function(e){var n=function(){k=!0,e()},t=function(){k=!1};return T("online",n),T("offline",t),function(){S("online",n),S("offline",t)}}},D=!b||"Deno"in window,L=b&&window.requestAnimationFrame||function(e){return setTimeout(e,1)},P=D?e:n,F="undefined"!=typeof navigator&&navigator.connection,M=!D&&F&&(["slow-2g","2g"].includes(F.effectiveType)||F.saveData),A=function(e){if(p(e))try{e=e()}catch(n){e=""}var n=[].concat(e);return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?E(e):"",n,e?"$err$"+e:"",e?"$req$"+e:""]},C=new WeakMap,W=function(e,n,t,r,i,o){for(var u=C.get(e),a=u[0],c=u[1],f=u[4],s=u[5],l=a[n],d=c[n]||[],v=0;v<d.length;++v)d[v](t,r,i);return o&&(delete f[n],delete s[n],l&&l[0])?l[0](2).then(function(){return e.get(n)}):e.get(n)},$=0,q=function(){return++$},J=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return f(void 0,void 0,void 0,function(){var n,t,r,i,o,u,a,c,f,l,d,h,g,y;return s(this,function(s){switch(s.label){case 0:if(n=e[0],t=e[1],r=!1!==e[3],i=e[2],o=A(t),u=o[0],a=o[2],!u)return[2];if(c=C.get(n),f=c[2],l=c[3],e.length<3)return[2,W(n,u,n.get(u),n.get(a),v,r)];if(g=f[u]=q(),l[u]=0,p(i))try{i=i(n.get(u))}catch(e){h=e}return i&&p(i.then)?[4,i.catch(function(e){h=e})]:[3,2];case 1:if(d=s.sent(),g!==f[u]){if(h)throw h;return[2,d]}return[3,3];case 2:d=i,s.label=3;case 3:return h||n.set(u,d),n.set(a,h),l[u]=q(),[4,W(n,u,d,h,v,r)];case 4:if(y=s.sent(),h)throw h;return[2,y]}})})},N=function(e,n){for(var t in e)e[t][0]&&e[t][0](n)},j=function(e,n){if(!C.has(e)){var t=y(x,n),r={},i=J.bind(v,e),o=d;if(C.set(e,[r,{},{},{},{},{},i]),!D){var u=t.initFocus(N.bind(v,r,0)),a=t.initReconnect(N.bind(v,r,1));o=function(){u&&u(),a&&a(),C.delete(e)}}return[e,i,o]}return[e,C.get(e)[6]]},G=j(new Map),H=G[0],z=G[1],B=y({onLoadingSlow:d,onSuccess:d,onError:d,onErrorRetry:function(e,n,t,r,i){if(I.isVisible()){var o=t.errorRetryCount,u=i.retryCount,a=~~((Math.random()+.5)*(1<<(u<8?u:8)))*t.errorRetryInterval;!g(o)&&u>o||setTimeout(r,a,i)}},onDiscarded:d,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:M?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:M?5e3:3e3,compare:function(e,n){return E(e)==E(n)},isPaused:function(){return!1},cache:H,mutate:z,fallback:{}},I),K=function(e,n){var t=y(e,n);if(n){var r=e.use,i=e.fallback,o=n.use,u=n.fallback;r&&o&&(t.use=r.concat(o)),i&&u&&(t.fallback=y(i,u))}return t},Q=t({}),U=function(e){return p(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}]},X=function(){return y(B,r(Q))},Y=function(e,n,t){var r=n[e]||(n[e]=[]);return r.push(t),function(){var e=r.indexOf(t);e>=0&&(r[e]=r[r.length-1],r.pop())}},Z={dedupe:!0},_=h.defineProperty(function(e){var n=e.value,t=K(r(Q),n),u=n&&n.provider,a=i(function(){return u?j(u(t.cache||H),n):v})[0];return a&&(t.cache=a[0],t.mutate=a[1]),P(function(){return a?a[2]:v},[]),o(Q.Provider,y(e,{value:t}))},"default",{value:B}),ee=function(e){return A(e)[0]},ne=(l=function(e,n,t){var r=t.cache,o=t.compare,l=t.fallbackData,d=t.suspense,h=t.revalidateOnMount,p=t.refreshInterval,b=t.refreshWhenHidden,w=t.refreshWhenOffline,m=C.get(r),O=m[0],E=m[1],k=m[2],T=m[3],R=m[4],S=m[5],V=A(e),I=V[0],x=V[1],F=V[2],M=V[3],$=u(!1),N=u(!1),j=u(I),G=u(t),H=function(){return G.current},z=r.get(I),B=g(l)?t.fallback[I]:l,K=g(z)?B:z,Q=r.get(F),U=function(){return g(h)?!H().isPaused()&&(d?!g(K):g(K)||t.revalidateIfStale):h},X=!(!I||!n)&&(!!r.get(M)||!$.current&&U()),_=function(e,n){var t=i({})[1],r=u(e),o=u({data:!1,error:!1,isValidating:!1}),c=a(function(e){var i=!1,u=r.current;for(var a in e){var c=a;u[c]!==e[c]&&(u[c]=e[c],o.current[c]&&(i=!0))}i&&!n.current&&t({})},[]);return P(function(){r.current=e}),[r,o.current,c]}({data:K,error:Q,isValidating:X},N),ee=_[0],ne=_[1],te=_[2],re=a(function(e){return f(void 0,void 0,void 0,function(){var i,u,a,c,f,l,d,h,p,y;return s(this,function(s){switch(s.label){case 0:if(!I||!n||N.current||H().isPaused())return[2,!1];a=!0,c=e||{},f=g(R[I])||!c.dedupe,l=function(){return!N.current&&I===j.current&&$.current},d=function(){S[I]===u&&(delete R[I],delete S[I])},h={isValidating:!1},p=function(){r.set(M,!1),l()&&te(h)},r.set(M,!0),te({isValidating:!0}),s.label=1;case 1:return s.trys.push([1,3,,4]),f&&(W(r,I,ee.current.data,ee.current.error,!0),t.loadingTimeout&&!r.get(I)&&setTimeout(function(){a&&l()&&H().onLoadingSlow(I,t)},t.loadingTimeout),S[I]=q(),R[I]=n.apply(void 0,x)),u=S[I],[4,R[I]];case 2:return i=s.sent(),f&&setTimeout(d,t.dedupingInterval),S[I]!==u?(f&&l()&&H().onDiscarded(I),[2,!1]):(r.set(F,v),h.error=v,!g(k[I])&&(u<=k[I]||u<=T[I]||0===T[I])?(p(),f&&l()&&H().onDiscarded(I),[2,!1]):(o(ee.current.data,i)||(h.data=i),o(r.get(I),i)||r.set(I,i),f&&l()&&H().onSuccess(i,I,t),[3,4]));case 3:return y=s.sent(),d(),H().isPaused()||(r.set(F,y),h.error=y,f&&l()&&(H().onError(y,I,t),t.shouldRetryOnError&&H().onErrorRetry(y,I,t,re,{retryCount:(c.retryCount||0)+1,dedupe:!0}))),[3,4];case 4:return a=!1,p(),l()&&f&&W(r,I,h.data,h.error,!1),[2,!0]}})})},[I]),ie=a(J.bind(v,r,function(){return j.current}),[]);if(P(function(){G.current=t}),P(function(){if(I){var e=$.current,n=re.bind(v,Z),t=function(){return H().isVisible()&&H().isOnline()},r=0,i=Y(I,E,function(e,n,t){te(y({error:n,isValidating:t},o(ee.current.data,e)?v:{data:e}))}),u=Y(I,O,function(e){if(0==e){var i=Date.now();H().revalidateOnFocus&&i>r&&t()&&(r=i+H().focusThrottleInterval,n())}else if(1==e)H().revalidateOnReconnect&&t()&&n();else if(2==e)return re()});return N.current=!1,j.current=I,$.current=!0,e&&te({data:K,error:Q,isValidating:X}),U()&&(g(K)||D?n():L(n)),function(){N.current=!0,i(),u()}}},[I,re]),P(function(){var e;function n(){p&&-1!==e&&(e=setTimeout(t,p))}function t(){ee.current.error||!b&&!H().isVisible()||!w&&!H().isOnline()?n():re(Z).then(n)}return n(),function(){e&&(clearTimeout(e),e=-1)}},[p,b,w,re]),c(K),d&&g(K))throw g(Q)?re(Z):Q;return{mutate:ie,get data(){return ne.data=!0,K},get error(){return ne.error=!0,Q},get isValidating(){return ne.isValidating=!0,X}}},function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=X(),r=U(e),i=r[0],o=r[1],u=r[2],a=K(t,u),c=l,f=a.use;if(f)for(var s=f.length;s-- >0;)c=f[s](c);return c(i,o||a.fetcher,a)});export{_ as SWRConfig,ne as default,z as mutate,ee as unstable_serialize,X as useSWRConfig};
