Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function n(e,n,t,r){return new(t||(t=Promise))(function(i,u){function o(e){try{c(r.next(e))}catch(e){u(e)}}function a(e){try{c(r.throw(e))}catch(e){u(e)}}function c(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(o,a)}c((r=r.apply(e,n||[])).next())})}function t(e,n){var t,r,i,u,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=n.call(e,o)}catch(e){u=[6,e],r=0}finally{t=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}}var r,i=function(){},u=i(),o=Object,a=function(e){return e===u},c=function(e){return"function"==typeof e},f=function(e,n){return o.assign({},e,n)},s="undefined"!=typeof window,l="undefined"!=typeof document,d=new WeakMap,v=0,g=function(e){var n,t,r=typeof e,i=e&&e.constructor,u=i==Date;if(o(e)!==e||u||i==RegExp)n=u?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(n=d.get(e))return n;if(n=++v+"~",d.set(e,n),i==Array){for(n="@",t=0;t<e.length;t++)n+=g(e[t])+",";d.set(e,n)}if(i==o){n="#";for(var c=o.keys(e).sort();!a(t=c.pop());)a(e[t])||(n+=t+":"+g(e[t])+",");d.set(e,n)}}return n},h=!0,p=s&&window.addEventListener?window.addEventListener.bind(window):i,b=l?document.addEventListener.bind(document):i,y=s&&window.removeEventListener?window.removeEventListener:i,w=l?document.removeEventListener.bind(document):i,m={isOnline:function(){return h},isVisible:function(){var e=l&&document.visibilityState;return!!a(e)||"hidden"!==e}},R={initFocus:function(e){return b("visibilitychange",e),p("focus",e),function(){w("visibilitychange",e),y("focus",e)}},initReconnect:function(e){var n=function(){h=!0,e()},t=function(){h=!1};return p("online",n),p("offline",t),function(){y("online",n),y("offline",t)}}},E=!s||"Deno"in window,k=s&&window.requestAnimationFrame||function(e){return setTimeout(e,1)},x=E?e.useEffect:e.useLayoutEffect,O="undefined"!=typeof navigator&&navigator.connection,S=!E&&O&&(["slow-2g","2g"].includes(O.effectiveType)||O.saveData),T=function(e){if(c(e))try{e=e()}catch(n){e=""}var n=[].concat(e);return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?g(e):"",n,e?"$err$"+e:"",e?"$req$"+e:""]},V=new WeakMap,C=function(e,n,t,r,i,u){for(var o=V.get(e),a=o[0],c=o[1],f=o[4],s=o[5],l=a[n],d=c[n]||[],v=0;v<d.length;++v)d[v](t,r,i);return u&&(delete f[n],delete s[n],l&&l[0])?l[0](2).then(function(){return e.get(n)}):e.get(n)},D=0,I=function(){return++D},L=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return n(void 0,void 0,void 0,function(){var n,r,i,o,a,f,s,l,d,v,g,h,p,b;return t(this,function(t){switch(t.label){case 0:if(n=e[0],r=e[1],i=!1!==e[3],o=e[2],a=T(r),f=a[0],s=a[2],!f)return[2];if(l=V.get(n),d=l[2],v=l[3],e.length<3)return[2,C(n,f,n.get(f),n.get(s),u,i)];if(p=d[f]=I(),v[f]=0,c(o))try{o=o(n.get(f))}catch(e){h=e}return o&&c(o.then)?[4,o.catch(function(e){h=e})]:[3,2];case 1:if(g=t.sent(),p!==d[f]){if(h)throw h;return[2,g]}return[3,3];case 2:g=o,t.label=3;case 3:return h||n.set(f,g),n.set(s,h),v[f]=I(),[4,C(n,f,g,h,u,i)];case 4:if(b=t.sent(),h)throw h;return[2,b]}})})},P=function(e,n){for(var t in e)e[t][0]&&e[t][0](n)},M=function(e,n){if(!V.has(e)){var t=f(R,n),r={},o=L.bind(u,e),a=i;if(V.set(e,[r,{},{},{},{},{},o]),!E){var c=t.initFocus(P.bind(u,r,0)),s=t.initReconnect(P.bind(u,r,1));a=function(){c&&c(),s&&s(),V.delete(e)}}return[e,o,a]}return[e,V.get(e)[6]]},W=M(new Map),F=W[0],A=W[1],$=f({onLoadingSlow:i,onSuccess:i,onError:i,onErrorRetry:function(e,n,t,r,i){if(m.isVisible()){var u=t.errorRetryCount,o=i.retryCount,c=~~((Math.random()+.5)*(1<<(o<8?o:8)))*t.errorRetryInterval;!a(u)&&o>u||setTimeout(r,c,i)}},onDiscarded:i,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:S?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:S?5e3:3e3,compare:function(e,n){return g(e)==g(n)},isPaused:function(){return!1},cache:F,mutate:A,fallback:{}},m),q=function(e,n){var t=f(e,n);if(n){var r=e.use,i=e.fallback,u=n.use,o=n.fallback;r&&u&&(t.use=r.concat(u)),i&&o&&(t.fallback=f(i,o))}return t},_=e.createContext({}),j=function(e){return c(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}]},J=function(){return f($,e.useContext(_))},N=function(e,n,t){var r=n[e]||(n[e]=[]);return r.push(t),function(){var e=r.indexOf(t);e>=0&&(r[e]=r[r.length-1],r.pop())}},z={dedupe:!0},G=o.defineProperty(function(n){var t=n.value,r=q(e.useContext(_),t),i=t&&t.provider,o=e.useState(function(){return i?M(i(r.cache||F),t):u})[0];return o&&(r.cache=o[0],r.mutate=o[1]),x(function(){return o?o[2]:u},[]),e.createElement(_.Provider,f(n,{value:r}))},"default",{value:$}),H=(r=function(r,i,o){var c=o.cache,s=o.compare,l=o.fallbackData,d=o.suspense,v=o.revalidateOnMount,g=o.refreshInterval,h=o.refreshWhenHidden,p=o.refreshWhenOffline,b=V.get(c),y=b[0],w=b[1],m=b[2],R=b[3],O=b[4],S=b[5],D=T(r),P=D[0],M=D[1],W=D[2],F=D[3],A=e.useRef(!1),$=e.useRef(!1),q=e.useRef(P),_=e.useRef(o),j=function(){return _.current},J=c.get(P),G=a(l)?o.fallback[P]:l,H=a(J)?G:J,B=c.get(W),K=function(){return a(v)?!j().isPaused()&&(d?!a(H):a(H)||o.revalidateIfStale):v},Q=!(!P||!i)&&(!!c.get(F)||!A.current&&K()),U=function(n,t){var r=e.useState({})[1],i=e.useRef(n),u=e.useRef({data:!1,error:!1,isValidating:!1}),o=e.useCallback(function(e){var n=!1,o=i.current;for(var a in e){var c=a;o[c]!==e[c]&&(o[c]=e[c],u.current[c]&&(n=!0))}n&&!t.current&&r({})},[]);return x(function(){i.current=n}),[i,u.current,o]}({data:H,error:B,isValidating:Q},$),X=U[0],Y=U[1],Z=U[2],ee=e.useCallback(function(e){return n(void 0,void 0,void 0,function(){var n,r,f,l,d,v,g,h,p,b;return t(this,function(t){switch(t.label){case 0:if(!P||!i||$.current||j().isPaused())return[2,!1];f=!0,l=e||{},d=a(O[P])||!l.dedupe,v=function(){return!$.current&&P===q.current&&A.current},g=function(){S[P]===r&&(delete O[P],delete S[P])},h={isValidating:!1},p=function(){c.set(F,!1),v()&&Z(h)},c.set(F,!0),Z({isValidating:!0}),t.label=1;case 1:return t.trys.push([1,3,,4]),d&&(C(c,P,X.current.data,X.current.error,!0),o.loadingTimeout&&!c.get(P)&&setTimeout(function(){f&&v()&&j().onLoadingSlow(P,o)},o.loadingTimeout),S[P]=I(),O[P]=i.apply(void 0,M)),r=S[P],[4,O[P]];case 2:return n=t.sent(),d&&setTimeout(g,o.dedupingInterval),S[P]!==r?(d&&v()&&j().onDiscarded(P),[2,!1]):(c.set(W,u),h.error=u,!a(m[P])&&(r<=m[P]||r<=R[P]||0===R[P])?(p(),d&&v()&&j().onDiscarded(P),[2,!1]):(s(X.current.data,n)||(h.data=n),s(c.get(P),n)||c.set(P,n),d&&v()&&j().onSuccess(n,P,o),[3,4]));case 3:return b=t.sent(),g(),j().isPaused()||(c.set(W,b),h.error=b,d&&v()&&(j().onError(b,P,o),o.shouldRetryOnError&&j().onErrorRetry(b,P,o,ee,{retryCount:(l.retryCount||0)+1,dedupe:!0}))),[3,4];case 4:return f=!1,p(),v()&&d&&C(c,P,h.data,h.error,!1),[2,!0]}})})},[P]),ne=e.useCallback(L.bind(u,c,function(){return q.current}),[]);if(x(function(){_.current=o}),x(function(){if(P){var e=A.current,n=ee.bind(u,z),t=function(){return j().isVisible()&&j().isOnline()},r=0,i=N(P,w,function(e,n,t){Z(f({error:n,isValidating:t},s(X.current.data,e)?u:{data:e}))}),o=N(P,y,function(e){if(0==e){var i=Date.now();j().revalidateOnFocus&&i>r&&t()&&(r=i+j().focusThrottleInterval,n())}else if(1==e)j().revalidateOnReconnect&&t()&&n();else if(2==e)return ee()});return $.current=!1,q.current=P,A.current=!0,e&&Z({data:H,error:B,isValidating:Q}),K()&&(a(H)||E?n():k(n)),function(){$.current=!0,i(),o()}}},[P,ee]),x(function(){var e;function n(){g&&-1!==e&&(e=setTimeout(t,g))}function t(){X.current.error||!h&&!j().isVisible()||!p&&!j().isOnline()?n():ee(z).then(n)}return n(),function(){e&&(clearTimeout(e),e=-1)}},[g,h,p,ee]),e.useDebugValue(H),d&&a(H))throw a(B)?ee(z):B;return{mutate:ne,get data(){return Y.data=!0,H},get error(){return Y.error=!0,B},get isValidating(){return Y.isValidating=!0,Q}}},function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=J(),i=j(e),u=i[0],o=i[1],a=i[2],c=q(t,a),f=r,s=c.use;if(s)for(var l=s.length;l-- >0;)f=s[l](f);return f(u,o||c.fetcher,c)});exports.SWRConfig=G,exports.default=H,exports.mutate=A,exports.unstable_serialize=function(e){return T(e)[0]},exports.useSWRConfig=J;
