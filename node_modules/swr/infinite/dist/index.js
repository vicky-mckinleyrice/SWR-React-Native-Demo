Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(require("swr"));function r(e,t,n,r){return new(n||(n=Promise))(function(u,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?u(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})}function u(e,t){var n,r,u,a,i={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(u=2&a[0]?r.return:a[0]?r.throw||((u=r.return)&&u.call(r),0):r.next)&&!(u=u.call(r,a[1])).done)return u;switch(r=0,u&&(a=[2&a[0],u.value]),a[0]){case 0:case 1:u=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(u=i.trys,(u=u.length>0&&u[u.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!u||a[1]>u[0]&&a[1]<u[3])){i.label=a[1];break}if(6===a[0]&&i.label<u[1]){i.label=u[1],u=a;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(a);break}u[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=u=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var a=function(){},i=a(),o=Object,l=function(e){return e===i},c=function(e){return"function"==typeof e},f=!("undefined"!=typeof window)||"Deno"in window,s=f?e.useEffect:e.useLayoutEffect,v="undefined"!=typeof navigator&&navigator.connection;!f&&v&&(["slow-2g","2g"].includes(v.effectiveType)||v.saveData);var p=new WeakMap,d=0,y=function(e){var t,n,r=typeof e,u=e&&e.constructor,a=u==Date;if(o(e)!==e||a||u==RegExp)t=a?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(t=p.get(e))return t;if(t=++d+"~",p.set(e,t),u==Array){for(t="@",n=0;n<e.length;n++)t+=y(e[n])+",";p.set(e,t)}if(u==o){t="#";for(var i=o.keys(e).sort();!l(n=i.pop());)l(e[n])||(t+=n+":"+y(e[n])+",");p.set(e,t)}}return t},b=function(e){if(c(e))try{e=e()}catch(t){e=""}var t=[].concat(e);return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?y(e):"",t,e?"$err$"+e:"",e?"$req$"+e:""]},g=function(){return g=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var u in t=arguments[n])Object.prototype.hasOwnProperty.call(t,u)&&(e[u]=t[u]);return e},g.apply(this,arguments)},h=function(e){return c(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}]},w=function(e){return b(e?e(0,null):null)[0]},$=function(t){return function(n,a,o){var f=e.useState({})[1],v=e.useRef(!1),p=e.useRef(),d=o.cache,y=o.initialSize,g=void 0===y?1:y,h=o.revalidateAll,$=void 0!==h&&h,x=o.persistSize,m=void 0!==x&&x,k=o.revalidateFirstPage,S=void 0===k||k,O=null;try{O=w(n)}catch(e){}var j=null,z=null;O&&(j="$ctx$"+O,z="$len$"+O);var A=e.useCallback(function(){var e=d.get(z);return l(e)?g:e},[z,g]),E=e.useRef(A());s(function(){v.current?O&&d.set(z,m?E.current:g):v.current=!0},[O]);var P=t(O?"$inf$"+O:null,function(){return r(void 0,void 0,void 0,function(){var e,t,r,i,c,f,s,v,y,g,h,w;return u(this,function(u){switch(u.label){case 0:e=d.get(j)||[],t=e[0],r=e[1],i=[],c=A(),f=null,s=0,u.label=1;case 1:return s<c?(v=b(n?n(s,f):null),y=v[0],g=v[1],y?(h=d.get(y),w=$||t||l(h)||S&&!s&&!l(p.current)||r&&!l(r[s])&&!o.compare(r[s],h),a&&w?[4,a.apply(void 0,g)]:[3,3]):[3,5]):[3,5];case 2:h=u.sent(),d.set(y,h),u.label=3;case 3:i.push(h),f=h,u.label=4;case 4:return++s,[3,1];case 5:return d.delete(j),[2,i]}})})},o);s(function(){p.current=P.data},[P.data]);var R=e.useCallback(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],r=!1!==e[1];if(j){if(r)if(l(n))d.set(j,[!0]);else{var u=p.current;d.set(j,[!1,u])}return e.length?P.mutate(n,r):P.mutate()}},[j]),q=e.useCallback(function(e){var t;if(z&&(c(e)?t=e(A()):"number"==typeof e&&(t=e),"number"==typeof t))return d.set(z,t),E.current=t,f({}),R(function(e){for(var t=[],r=null,u=0;u<e;++u){var a=b(n?n(u,r):null)[0],o=a?d.get(a):i;if(l(o))return p.current;t.push(o),r=o}return t}(t))},[z,A,R]);return{size:A(),setSize:q,mutate:R,get error(){return P.error},get data(){return P.data},get isValidating(){return P.isValidating}}}},x=function(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var u=h(n),a=u[0],i=u[1],o=u[2],l=(o.use||[]).concat(t);return e(a,i,g(g({},o),{use:l}))}}(n.default,$);exports.default=x,exports.infinite=$,exports.unstable_serialize=function(e){return"$inf$"+w(e)};
