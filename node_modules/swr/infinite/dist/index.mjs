import{useEffect as t,useLayoutEffect as n,useState as e,useRef as r,useCallback as u}from"react";import o from"swr";function a(t,n,e,r){return new(e||(e=Promise))(function(u,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?u(t.value):(n=t.value,n instanceof e?n:new e(function(t){t(n)})).then(a,i)}c((r=r.apply(t,n||[])).next())})}function i(t,n){var e,r,u,o,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(u=2&o[0]?r.return:o[0]?r.throw||((u=r.return)&&u.call(r),0):r.next)&&!(u=u.call(r,o[1])).done)return u;switch(r=0,u&&(o=[2&o[0],u.value]),o[0]){case 0:case 1:u=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(u=a.trys,(u=u.length>0&&u[u.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!u||o[1]>u[0]&&o[1]<u[3])){a.label=o[1];break}if(6===o[0]&&a.label<u[1]){a.label=u[1],u=o;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(o);break}u[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(t,a)}catch(t){o=[6,t],r=0}finally{e=u=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}}var c=function(){},l=c(),f=Object,s=function(t){return t===l},v=function(t){return"function"==typeof t},p=!("undefined"!=typeof window)||"Deno"in window,y=p?t:n,d="undefined"!=typeof navigator&&navigator.connection;!p&&d&&(["slow-2g","2g"].includes(d.effectiveType)||d.saveData);var g=new WeakMap,h=0,b=function(t){var n,e,r=typeof t,u=t&&t.constructor,o=u==Date;if(f(t)!==t||o||u==RegExp)n=o?t.toJSON():"symbol"==r?t.toString():"string"==r?JSON.stringify(t):""+t;else{if(n=g.get(t))return n;if(n=++h+"~",g.set(t,n),u==Array){for(n="@",e=0;e<t.length;e++)n+=b(t[e])+",";g.set(t,n)}if(u==f){n="#";for(var a=f.keys(t).sort();!s(e=a.pop());)s(t[e])||(n+=e+":"+b(t[e])+",");g.set(t,n)}}return n},w=function(t){if(v(t))try{t=t()}catch(n){t=""}var n=[].concat(t);return[t="string"==typeof t?t:(Array.isArray(t)?t.length:t)?b(t):"",n,t?"$err$"+t:"",t?"$req$"+t:""]},m=function(){return m=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var u in n=arguments[e])Object.prototype.hasOwnProperty.call(n,u)&&(t[u]=n[u]);return t},m.apply(this,arguments)},$=function(t){return v(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(null===t[1]?t[2]:t[1])||{}]},x=function(t){return w(t?t(0,null):null)[0]},S=function(t){return"$inf$"+x(t)},k=function(t){return function(n,o,c){var f=e({})[1],p=r(!1),d=r(),g=c.cache,h=c.initialSize,b=void 0===h?1:h,m=c.revalidateAll,$=void 0!==m&&m,S=c.persistSize,k=void 0!==S&&S,O=c.revalidateFirstPage,z=void 0===O||O,A=null;try{A=x(n)}catch(t){}var j=null,D=null;A&&(j="$ctx$"+A,D="$len$"+A);var P=u(function(){var t=g.get(D);return s(t)?b:t},[D,b]),E=r(P());y(function(){p.current?A&&g.set(D,k?E.current:b):p.current=!0},[A]);var J=t(A?"$inf$"+A:null,function(){return a(void 0,void 0,void 0,function(){var t,e,r,u,a,l,f,v,p,y,h,b;return i(this,function(i){switch(i.label){case 0:t=g.get(j)||[],e=t[0],r=t[1],u=[],a=P(),l=null,f=0,i.label=1;case 1:return f<a?(v=w(n?n(f,l):null),p=v[0],y=v[1],p?(h=g.get(p),b=$||e||s(h)||z&&!f&&!s(d.current)||r&&!s(r[f])&&!c.compare(r[f],h),o&&b?[4,o.apply(void 0,y)]:[3,3]):[3,5]):[3,5];case 2:h=i.sent(),g.set(p,h),i.label=3;case 3:u.push(h),l=h,i.label=4;case 4:return++f,[3,1];case 5:return g.delete(j),[2,u]}})})},c);y(function(){d.current=J.data},[J.data]);var N=u(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=t[0],r=!1!==t[1];if(j){if(r)if(s(e))g.set(j,[!0]);else{var u=d.current;g.set(j,[!1,u])}return t.length?J.mutate(e,r):J.mutate()}},[j]),T=u(function(t){var e;if(D&&(v(t)?e=t(P()):"number"==typeof t&&(e=t),"number"==typeof e))return g.set(D,e),E.current=e,f({}),N(function(t){for(var e=[],r=null,u=0;u<t;++u){var o=w(n?n(u,r):null)[0],a=o?g.get(o):l;if(s(a))return d.current;e.push(a),r=a}return e}(e))},[D,P,N]);return{size:P(),setSize:T,mutate:N,get error(){return J.error},get data(){return J.data},get isValidating(){return J.isValidating}}}},O=function(t,n){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var u=$(e),o=u[0],a=u[1],i=u[2],c=(i.use||[]).concat(n);return t(o,a,m(m({},i),{use:c}))}}(o,k);export{O as default,k as infinite,S as unstable_serialize};
